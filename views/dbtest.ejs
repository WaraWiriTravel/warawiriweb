<!-- Pemanggilan bagian header -->
<%- include("partials/header") %>
<!-- Pemanggilan bagian Navbar -->
<%- include("partials/navbar") %>

<!-- Start dbtest -->
<div class="container">
  <h2>Create New Post</h2>
  <form action="/createpost" method="POST" enctype="multipart/form-data">
    <div class="form-group">
      <label for="title">Title:</label>
      <input type="text" name="title" id="title" class="form-control" required>
    </div>
    <div class="form-group">
      <label for="content">Content:</label>
      <textarea name="content" id="content" class="form-control" rows="4" required></textarea>
    </div>
    <div class="form-group">
      <label for="image">Image:</label>
      <input type="file" name="image" id="image" accept="image/jpeg, image/jpg, image/png" required>
    </div>
    <button type="submit" class="btn btn-primary">Submit</button>
  </form>

  <h4>Posts:</h4>
  <ul>
    <% blogs.forEach(blog => { %>
      <li>
        <div class="d-flex justify-content-between align-items-center">
          <div style="max-width: 600px;">
            <h5><%= blog.title %></h5>
          </div>
          <div>
            <button class="btn btn-link" onclick="window.location.href='/blog-detail-<%= blog.title %>'">Show</button>
            <button class="btn btn-link" onclick="updateBlog('<%= blog.title %>', '<%= blog.content %>', '<%= blog.imageUrl %>', '<%= blog.documentID %>')">Update</button>
            <button class="btn btn-link text-danger" onclick="deleteBlog('<%= blog.documentID %>')">Delete</button>
          </div>
        </div>
        <div id="content-<%= blog.title %>" style="display: none;">
          <img src="<%= blog.imageUrl %>" alt="<%= blog.title %> Image" style="max-width:500px; display: block; margin: 0 auto;">
          <p><strong>Content:</strong> <%= blog.content %></p>
        </div>
      </li>
    <% }); %>
  </ul>
</div>
<!-- End dbtest -->

<!-- Pemanggilan bagian footer -->
<%- include("partials/footer") %>

<script>
  function updateBlog(title, content, imageUrl, documentID) {
    const selectedBlog = { title, content, imageUrl, documentID };
    const queryParams = new URLSearchParams(selectedBlog).toString();
    const url = '/dbtest2?' + queryParams;

    window.location.href = url;
  }

  function deleteBlog(documentID) {
    if (confirm("Are you sure you want to delete " + documentID + " post?")) {
      fetch(`/deletepost/${documentID}`, {
        method: "POST",
      })
        .then((response) => {
          if (response.ok) {
            location.reload();
          } else {
            console.error("Error deleting the post");
          }
        })
        .catch((error) => {
          console.error("Error deleting the post:", error);
        });
    }
  }
</script>